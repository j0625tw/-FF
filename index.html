<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>哪夠呀・NAGOYA 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --base: #F5F2ED; --accent: #8C7355; --text: #4A443F; }
        body { background-color: var(--base); color: var(--text); font-family: -apple-system, sans-serif; }
        .spot-card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(140, 115, 85, 0.05); border-left: 5px solid var(--accent); position: relative; transition: transform 0.1s; cursor: pointer; }
        .spot-card:active { transform: scale(0.98); }
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100; }
        .date-btn.active { background: var(--accent); color: white; transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input, textarea { background: #f9f8f6; border: 1px solid #e2e0db; border-radius: 8px; padding: 4px 8px; width: 100%; }
    </style>
</head>
<body class="pb-32">

    <header class="pt-8 px-6 mb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-black text-[#8C7355] italic">NAGOYA</h1>
            <p class="text-[10px] tracking-widest text-gray-400 font-bold">WINTER 2025 · 行程管理</p>
        </div>
        <button onclick="toggleEditMode()" id="edit-toggle" class="bg-stone-200 px-4 py-1 rounded-full text-xs font-bold">編輯模式: OFF</button>
    </header>

    <div class="px-6 mb-6">
        <div class="w-full h-40 rounded-[2rem] overflow-hidden shadow-lg border-4 border-white">
            <iframe id="map-frame" width="100%" height="100%" frameborder="0" src=""></iframe>
        </div>
    </div>

    <div class="flex overflow-x-auto px-6 space-x-3 mb-6 no-scrollbar" id="date-tabs"></div>
    <main id="app-content" class="px-6 space-y-4"></main>

    <div id="add-modal" class="fixed inset-0 bg-black/50 z-[200] hidden flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 space-y-4">
            <h3 class="font-bold">新增行程點</h3>
            <input type="text" id="new-time" placeholder="時間 (如 09:00)">
            <input type="text" id="new-name" placeholder="地點名稱">
            <textarea id="new-desc" placeholder="詳細描述/交通資訊"></textarea>
            <div class="flex space-x-2">
                <button onclick="saveNewSpot()" class="flex-1 bg-[#8C7355] text-white py-2 rounded-xl">儲存</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-100 py-2 rounded-xl">取消</button>
            </div>
        </div>
    </div>

    <nav class="floating-nav px-8 py-4 flex justify-between items-center text-[#8C7355]">
        <div onclick="window.scrollTo({top:0, behavior:'smooth'})" class="flex flex-col items-center"><i class="fas fa-home"></i><span class="text-[9px]">首頁</span></div>
        <div onclick="showAddModal()" class="bg-[#8C7355] text-white w-12 h-12 rounded-full flex items-center justify-center -mt-10 shadow-lg"><i class="fas fa-plus"></i></div>
        <div onclick="exportData()" class="flex flex-col items-center opacity-40"><i class="fas fa-share-square"></i><span class="text-[9px]">導出</span></div>
    </nav>

    <script>
        const defaultData = {
            "1221": { title: "Day 1：抵達名古屋", spots: [
                { time: "14:55", name: "桃園機場", desc: "星宇 JX838 18:30 抵達" },
                { time: "19:00", name: "名鐵 μ-SKY", desc: "前往名古屋站" },
                { time: "20:00", name: "名古屋新幹線口大和ROYNET酒店", desc: "入住休息" },
                { time: "20:15", name: "名古屋車站地下街", desc: "金鯱橫丁晚餐：味噌豬排、鰻魚飯" }
            ]},
            "1222": { title: "Day 2：犬山城+市區", spots: [
                { time: "08:30", name: "犬山城下町", desc: "逛街小吃、咖啡甜點" },
                { time: "10:15", name: "犬山城天守閣", desc: "國寶天守參觀" },
                { time: "13:30", name: "大須商店街", desc: "商店街巡禮與美食" },
                { time: "15:15", name: "榮區 Oasis21", desc: "購物與地標拍照" }
            ]},
            "1223": { title: "Day 3：名古屋 → 高山", spots: [
                { time: "07:45", name: "名古屋新幹線巴士站", desc: "巴士前往高山" },
                { time: "11:00", name: "高山陣屋", desc: "江戶官署參觀" },
                { time: "13:00", name: "高山古街", desc: "上三之町散策、飛驒牛" }
            ]},
            "1224": { title: "Day 4：高山 → 白川鄉", spots: [
                { time: "07:20", name: "高山濃飛巴士", desc: "前往白川鄉" },
                { time: "09:00", name: "白川鄉展望台", desc: "合掌村全景" },
                { time: "14:30", name: "白川鄉巴士站", desc: "返抵名古屋" }
            ]},
            "1225": { title: "Day 5：吉卜力公園", spots: [
                { time: "08:00", name: "名古屋站", desc: "地鐵東山線至藤之丘 → 轉Linimo" },
                { time: "09:30", name: "地球市民交流中心(E1站牌)", desc: "搭乘園區免費接駁巴士" },
                { time: "10:00", name: "動動力森林", desc: "順序：動動力森林區 → 魔女之谷 → 魔法之里 → 青春之丘" },
                { time: "14:00", name: "吉卜力大倉庫", desc: "依預約票券時間入場" }
            ]},
            "1226": { title: "Day 6：最終採購", spots: [
                { time: "09:00", name: "熱田神宮", desc: "參拜拍照" },
                { time: "10:45", name: "名古屋城", desc: "本丸御殿參觀" },
                { time: "19:40", name: "中部國際機場", desc: "星宇 JX839 返回桃園" }
            ]}
        };

        let myTrip = JSON.parse(localStorage.getItem('nagoya_trip')) || defaultData;
        let currentDay = "1221";
        let isEditMode = false;

        function renderTabs() {
            const container = document.getElementById('date-tabs');
            container.innerHTML = Object.keys(myTrip).sort().map(day => `
                <button onclick="switchDay('${day}')" id="btn-${day}" class="date-btn flex-shrink-0 px-6 py-2.5 rounded-full bg-white shadow-sm text-sm font-bold ${currentDay === day ? 'active' : ''}">${day.slice(0,2)}/${day.slice(2)}</button>
            `).join('');
        }

        function switchDay(day) {
            currentDay = day;
            renderContent();
            renderTabs();
        }

        function renderContent() {
            const container = document.getElementById('app-content');
            const data = myTrip[currentDay];
            document.getElementById('map-frame').src = `https://maps.google.com/maps?q=${encodeURIComponent(data.spots[0]?.name || '名古屋')}&t=&z=14&ie=UTF8&iwloc=&output=embed`;

            container.innerHTML = `<h2 class="text-xl font-bold">${data.title}</h2>`;
            container.innerHTML += data.spots.map((spot, index) => `
                <div class="spot-card p-5" onclick="${isEditMode ? '' : `window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(spot.name)}')`}">
                    ${isEditMode ? `<button onclick="event.stopPropagation(); deleteSpot(${index})" class="text-red-500 absolute top-4 right-4"><i class="fas fa-times-circle"></i></button>` : ''}
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            ${isEditMode ? `<input type="text" onchange="updateSpot(${index}, 'name', this.value)" value="${spot.name}" class="font-bold mb-1" onclick="event.stopPropagation()">` : `<h3 class="text-base font-bold text-gray-800">${spot.name}</h3>`}
                            ${isEditMode ? `<textarea onchange="updateSpot(${index}, 'desc', this.value)" class="text-xs mt-1" onclick="event.stopPropagation()">${spot.desc}</textarea>` : `<p class="text-[12px] text-gray-500 mt-1">${spot.desc}</p>`}
                        </div>
                        <div class="text-right ml-4">
                            ${isEditMode ? `<input type="text" onchange="updateSpot(${index}, 'time', this.value)" value="${spot.time}" class="text-sm font-black text-right" onclick="event.stopPropagation()">` : `<span class="text-sm font-black text-[#8C7355] font-mono">${spot.time}</span>`}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            document.getElementById('edit-toggle').innerText = `編輯模式: ${isEditMode ? 'ON' : 'OFF'}`;
            document.getElementById('edit-toggle').classList.toggle('bg-[#8C7355]');
            document.getElementById('edit-toggle').classList.toggle('text-white');
            renderContent();
        }

        function updateSpot(index, field, value) {
            myTrip[currentDay].spots[index][field] = value;
            saveData();
        }

        function deleteSpot(index) {
            if(confirm('確定要刪除？')) {
                myTrip[currentDay].spots.splice(index, 1);
                saveData();
                renderContent();
            }
        }

        function showAddModal() { document.getElementById('add-modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('add-modal').classList.add('hidden'); }

        function saveNewSpot() {
            const newSpot = {
                time: document.getElementById('new-time').value,
                name: document.getElementById('new-name').value,
                desc: document.getElementById('new-desc').value
            };
            myTrip[currentDay].spots.push(newSpot);
            myTrip[currentDay].spots.sort((a,b) => a.time.localeCompare(b.time));
            saveData();
            renderContent();
            closeModal();
            document.getElementById('new-time').value = '';
            document.getElementById('new-name').value = '';
            document.getElementById('new-desc').value = '';
        }

        function saveData() { localStorage.setItem('nagoya_trip', JSON.stringify(myTrip)); }
        function exportData() { prompt("行程代碼 (複製可用於同步):", JSON.stringify(myTrip)); }

        renderTabs();
        renderContent();
    </script>
</body>
</html>
