<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>名古屋・冬の旅 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --base: #F5F2ED; --accent: #8C7355; --text: #4A443F; }
        body { background-color: var(--base); color: var(--text); font-family: -apple-system, sans-serif; overflow-x: hidden; }
        .spot-card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(140, 115, 85, 0.05); border-left: 4px solid var(--accent); }
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 100; border: 1px solid rgba(255,255,255,0.3); }
        .date-btn.active { background: var(--accent); color: white; transform: scale(1.05); }
        .tag-pill { font-size: 10px; padding: 2px 8px; border-radius: 6px; background: #f0ede9; color: #8C7355; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-32">

    <header class="pt-8 px-6 mb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-black text-[#8C7355] tracking-tight italic">NAGOYA</h1>
            <p class="text-[10px] tracking-[0.2em] text-gray-400 font-bold uppercase">Winter Itinerary 2025</p>
        </div>
        <div id="quick-temp" class="text-right">
            <p class="text-2xl font-light">6°C</p>
            <p class="text-[10px] text-gray-400">Cloudy / Nagoya</p>
        </div>
    </header>

    <div class="px-6 mb-6">
        <div class="w-full h-44 rounded-[2rem] overflow-hidden shadow-lg border-4 border-white">
            <iframe id="map-frame" width="100%" height="100%" frameborder="0" style="filter: sepia(20%) contrast(90%);" src=""></iframe>
        </div>
    </div>

    <div class="flex overflow-x-auto px-6 space-x-3 mb-6 no-scrollbar" id="date-tabs"></div>

    <main id="app-content" class="px-6 space-y-5"></main>

    <nav class="floating-nav px-8 py-4 flex justify-between items-center text-gray-400">
        <i class="fas fa-calendar-day text-[#8C7355] text-xl"></i>
        <i class="fas fa-utensils text-xl" onclick="alert('美食清單同步中')"></i>
        <i class="fas fa-plus-circle text-3xl text-[#8C7355]" onclick="alert('功能開發中')"></i>
        <i class="fas fa-map-marked-alt text-xl"></i>
        <i class="fas fa-user-friends text-xl"></i>
    </nav>

    <script>
        // --- Firebase 設定 (請在此填入你的 Key) ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT",
            appId: "YOUR_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentDay = "1221";

        // --- 100% 完整的詳細行程資料庫 ---
        const initialData = {
            "1221": {
                date: "12/21 (日)", loc: "名古屋抵達",
                spots: [
                    { time: "15:45", type: "交通", name: "桃園國際機場", desc: "國泰航空 CX531 辦理登機", tags: ["機場"] },
                    { time: "18:30", type: "交通", name: "中部國際機場 (NGO)", desc: "入境後購買 μ-SKY 車票", tags: ["必拍"] },
                    { time: "20:00", type: "酒店", name: "大和ROYNET酒店", desc: "名古屋新幹線口 Check-in 放置行李", tags: ["休息"] },
                    { time: "21:00", type: "食物", name: "名古屋車站美食街", desc: "世界的山將手羽先 或 矢場丼豬排", tags: ["必吃"] }
                ]
            },
            "1222": {
                date: "12/22 (一)", loc: "犬山與榮區",
                spots: [
                    { time: "09:00", type: "交通", name: "名鐵名古屋站", desc: "搭乘名鐵前往犬山遊園站", tags: ["車資$610"] },
                    { time: "10:30", type: "景點", name: "國寶犬山城", desc: "現存最古老天守，門票 $550", tags: ["必拍", "國寶"] },
                    { time: "13:00", type: "食物", name: "犬山城下町", desc: "昭和感老街，各種串燒美食", tags: ["必吃"] },
                    { time: "16:00", type: "購物", name: "大須商店街", desc: "大須觀音與精品老鋪巡禮", tags: ["必買"] },
                    { time: "19:00", type: "景點", name: "Oasis 21 綠之水景", desc: "榮區地標，拍電視塔最佳位置", tags: ["必拍"] }
                ]
            },
            "1223": {
                date: "12/23 (二)", loc: "飛驒高山之旅",
                spots: [
                    { time: "07:30", type: "交通", name: "名古屋巴士總站", desc: "搭乘濃飛巴士前往高山 ($3,100)", tags: ["需預約"] },
                    { time: "10:20", type: "交通", name: "高山濃飛巴士中心", desc: "抵達，行李寄存於車站櫃檯", tags: ["冷"] },
                    { time: "11:30", type: "食物", name: "高山古街 (上三之町)", desc: "飛驒牛壽司、牛串燒、五平餅", tags: ["必吃"] },
                    { time: "14:00", type: "景點", name: "高山陣屋", desc: "江戶時代官署，感受日式庭園", tags: ["歷史"] },
                    { time: "18:00", type: "食物", name: "丸明 飛驒牛燒肉", desc: "人氣燒肉店，享受頂級牛肉", tags: ["必吃"] }
                ]
            },
            "1224": {
                date: "12/24 (三)", loc: "白川鄉合掌村",
                spots: [
                    { time: "08:50", type: "交通", name: "白川鄉合掌村", desc: "搭乘預約巴士前往童話村落", tags: ["必拍"] },
                    { time: "11:00", type: "景點", name: "城山展望台", desc: "俯瞰整個合掌造村落全景", tags: ["必拍", "聖誕節"] },
                    { time: "14:30", type: "活動", name: "長瀨家 / 神田家", desc: "參觀合掌造內部結構", tags: ["歷史"] },
                    { time: "17:30", type: "酒店", name: "高山飯店", desc: "領取行李，返回名古屋或續住", tags: ["回程"] }
                ]
            },
            "1225": {
                date: "12/25 (四)", loc: "吉卜力公園全日",
                spots: [
                    { time: "09:00", type: "交通", name: "愛地球博紀念公園站", desc: "搭乘 Linimo 磁浮列車抵達", tags: ["聖誕"] },
                    { time: "10:00", type: "活動", name: "吉卜力大倉庫", desc: "核心展區，所有經典場景集合", tags: ["必拍", "預約制"] },
                    { time: "14:00", type: "活動", name: "幽靈之里 / 動動力森林", desc: "龍貓公車站、草壁家參觀", tags: ["必拍"] },
                    { time: "18:00", type: "購物", name: "名鐵百貨 / Bic Camera", desc: "名古屋站前最後補貨採購", tags: ["必買"] }
                ]
            },
            "1226": {
                date: "12/26 (五)", loc: "熱田神宮 / 歸途",
                spots: [
                    { time: "09:30", type: "景點", name: "熱田神宮", desc: "日本三大神宮之一，感受莊嚴氣氛", tags: ["必拍"] },
                    { time: "12:00", type: "食物", name: "蓬萊軒 鰻魚飯", desc: "神宮前店，三吃法鰻魚飯始祖", tags: ["必吃"] },
                    { time: "14:00", type: "交通", name: "前往機場", desc: "搭乘 μ-SKY 前往中部國際機場", tags: ["交通"] },
                    { time: "17:00", type: "交通", name: "中部機場 免稅店", desc: "購買蝦餅、白色戀人等伴手禮", tags: ["必買"] },
                    { time: "19:15", type: "交通", name: "起飛返台", desc: "國泰航空 CX530 帶著滿滿回憶歸家", tags: ["結束"] }
                ]
            }
        };

        // 資料庫監聽與初始化
        db.ref('itinerary').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) {
                db.ref('itinerary').set(initialData);
                return;
            }
            renderTabs(data);
            renderContent(data[currentDay]);
        });

        function renderTabs(data) {
            const container = document.getElementById('date-tabs');
            container.innerHTML = Object.keys(data).sort().map(day => `
                <button onclick="switchDay('${day}')" id="btn-${day}" 
                    class="date-btn flex-shrink-0 px-6 py-2.5 rounded-full bg-white shadow-sm text-sm font-bold transition-all ${currentDay === day ? 'active' : ''}">
                    ${day.slice(0,2)}/${day.slice(2)}
                </button>
            `).join('');
        }

        function switchDay(day) {
            currentDay = day;
            db.ref('itinerary').once('value', s => renderContent(s.val()[day]));
            document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${day}`).classList.add('active');
        }

        function renderContent(dayData) {
            const container = document.getElementById('app-content');
            if(!dayData) return;

            // 更新地圖：自動定位當天第一個點
            const firstSpot = dayData.spots[0].name;
            document.getElementById('map-frame').src = `https://maps.google.com/maps?q=${encodeURIComponent(firstSpot)}&t=&z=14&ie=UTF8&iwloc=&output=embed`;

            container.innerHTML = `<p class="text-sm font-bold text-[#8C7355] mb-2"><i class="fas fa-map-marker-alt mr-1"></i> ${dayData.loc}</p>`;
            
            container.innerHTML += dayData.spots.map(spot => `
                <div class="spot-card p-5" onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(spot.name)}')">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <span class="text-[10px] bg-[#8C7355] text-white px-2 py-0.5 rounded-md font-bold uppercase">${spot.type}</span>
                                <h3 class="text-base font-bold text-gray-800">${spot.name}</h3>
                            </div>
                            <p class="text-xs text-gray-500 mt-2 font-medium">${spot.desc}</p>
                        </div>
                        <div class="text-right ml-4">
                            <span class="text-sm font-black text-[#8C7355] font-mono">${spot.time}</span>
                        </div>
                    </div>
                    <div class="mt-3 flex flex-wrap gap-1">
                        ${spot.tags.map(t => `<span class="tag-pill italic">#${t}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
