<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>哪夠呀・NAGOYA 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --base: #F5F2ED; --accent: #8C7355; --text: #4A443F; }
        body { background-color: var(--base); color: var(--text); font-family: -apple-system, sans-serif; }
        .weather-card { background: linear-gradient(135deg, #8C7355 0%, #6D5942 100%); color: white; border-radius: 24px; box-shadow: 0 10px 20px rgba(140, 115, 85, 0.2); }
        .spot-card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-left: 5px solid var(--accent); position: relative; transition: transform 0.1s; cursor: pointer; }
        .spot-card:active { transform: scale(0.98); }
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100; }
        .date-btn.active { background: var(--accent); color: white; transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input, textarea { background: #f9f8f6; border: 1px solid #e2e0db; border-radius: 8px; padding: 6px 10px; width: 100%; font-size: 14px; }
    </style>
</head>
<body class="pb-36">

    <header class="pt-8 px-6 mb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-black text-[#8C7355] italic tracking-tighter">NAGOYA</h1>
            <p class="text-[10px] tracking-[0.2em] text-gray-400 font-bold uppercase">Winter Trip 2025</p>
        </div>
        <button onclick="toggleEditMode()" id="edit-toggle" class="bg-stone-200 px-4 py-1 rounded-full text-[10px] font-bold">EDIT: OFF</button>
    </header>

    <div class="px-6 mb-6">
        <div class="weather-card p-6 flex justify-between items-center relative overflow-hidden">
            <div class="z-10">
                <p id="weather-city" class="text-xs font-bold opacity-80 tracking-widest uppercase mb-1">LOADING</p>
                <div class="flex items-center">
                    <span id="weather-temp" class="text-5xl font-light">--</span>
                    <span class="text-2xl ml-1">°C</span>
                </div>
                <p id="weather-desc" class="text-sm mt-1 font-medium italic underline cursor-pointer">點擊看預報</p>
            </div>
            <div class="text-right z-10">
                <i id="weather-icon" class="fas fa-snowflake text-6xl opacity-30"></i>
            </div>
        </div>
    </div>

    <div class="flex overflow-x-auto px-6 space-x-3 mb-6 no-scrollbar" id="date-tabs"></div>
    <main id="app-content" class="px-6 space-y-4"></main>

    <nav class="floating-nav px-8 py-4 flex justify-between items-center text-[#8C7355]">
        <div onclick="window.scrollTo({top:0, behavior:'smooth'})" class="flex flex-col items-center">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[9px] font-bold mt-1">HOME</span>
        </div>
        <div onclick="showAddModal()" class="bg-[#8C7355] text-white w-12 h-12 rounded-full flex items-center justify-center -mt-10 shadow-lg border-4 border-[#F5F2ED]">
            <i class="fas fa-plus text-xl"></i>
        </div>
        <div onclick="exportData()" class="flex flex-col items-center text-gray-300">
            <i class="fas fa-sync-alt text-xl"></i>
            <span class="text-[9px] font-bold mt-1">SYNC</span>
        </div>
    </nav>

    <script>
        const defaultData = {
            "1221": { title: "Day 1：抵達名古屋", city: "Nagoya", spots: [
                { time: "18:30", name: "中部國際機場", desc: "抵達出關，搭 μ-SKY 前往名站" },
                { time: "20:30", name: "名古屋車站", desc: "飯店 Check-in，晚餐：味噌豬排" }
            ]},
            "1222": { title: "Day 2：犬山城與榮區購物", city: "Inuyama", spots: [
                { time: "08:30", name: "名古屋站", desc: "名鐵前往犬山遊園站" },
                { time: "09:30", name: "犬山城天守閣", desc: "登頂俯瞰木曾川" },
                { time: "12:00", name: "犬山城下町", desc: "午餐邊走邊吃" },
                { time: "15:00", name: "大須商店街", desc: "走馬看花逛特色小店" },
                { time: "17:00", name: "榮區商圈", desc: "百貨逛街、採買行程" }
            ]},
            "1223": { title: "Day 3：高山老街巡禮", city: "Takayama", spots: [
                { time: "07:45", name: "名古屋巴士總站", desc: "搭乘濃飛巴士" },
                { time: "11:00", name: "高山站", desc: "飯店寄放行李" },
                { time: "11:30", name: "上三之町老街", desc: "午餐：飛驒牛握壽司、小吃巡禮" },
                { time: "13:30", name: "中橋 / 陣屋前", desc: "紅色橋拍照，逛逛周邊古建築" },
                { time: "14:30", name: "高山陣屋", desc: "參觀歷史官署" },
                { time: "16:00", name: "飛驒高山社區巴士", desc: "可自選：飛驒之里(看屋)或博物館" },
                { time: "18:00", name: "飛驒牛燒肉", desc: "晚餐預約丸明或味藏天國" }
            ]},
            "1224": { title: "Day 4：合掌村與最終名古屋", city: "Ono", spots: [
                { time: "07:50", name: "高山濃飛巴士站", desc: "前往白川鄉合掌村" },
                { time: "09:00", name: "城山展望台", desc: "必拍！合掌村全景" },
                { time: "10:30", name: "合掌村漫步", desc: "參觀和田家、明善寺" },
                { time: "14:30", name: "白川鄉離開", desc: "搭車返回名古屋(預計17:16抵)" },
                { time: "18:30", name: "豐田產業技術紀念館", desc: "若是提早回名站可逛(最後入場16:30)，或改逛百貨" }
            ]},
            "1225": { title: "Day 5：吉卜力全攻略", city: "Nagakute", spots: [
                { time: "08:30", name: "名古屋站出發", desc: "東山線至藤之丘，轉 Linimo" },
                { time: "09:40", name: "E1 接駁站牌", desc: "搭巴士前往「動動力森林」" },
                { time: "14:00", name: "吉卜力大倉庫", desc: "精華區域，預留3小時以上" }
            ]},
            "1226": { title: "Day 6：最終採買歸途", city: "Nagoya", spots: [
                { time: "09:00", name: "熱田神宮", desc: "悠閒參拜" },
                { time: "11:00", name: "大須商店街", desc: "最後補貨與藥妝採買" },
                { time: "15:30", name: "名古屋站", desc: "搭 μ-SKY 前往中部機場" }
            ]}
        };

        let myTrip = JSON.parse(localStorage.getItem('nagoya_trip')) || defaultData;
        let currentDay = "1221";
        let isEditMode = false;

        async function fetchWeather(city) {
            const cities = { "Nagoya": { lat: 35.18, lon: 136.90 }, "Takayama": { lat: 36.14, lon: 137.25 }, "Ono": { lat: 36.27, lon: 136.90 }, "Inuyama": { lat: 35.38, lon: 136.94 }, "Nagakute": { lat: 35.18, lon: 137.05 } };
            const { lat, lon } = cities[city] || cities["Nagoya"];
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await res.json();
                document.getElementById('weather-temp').innerText = Math.round(data.current_weather.temperature);
                document.getElementById('weather-city').innerText = city === "Ono" ? "Shirakawa-go" : city;
                document.getElementById('weather-desc').onclick = () => window.open('https://www.accuweather.com/zh/jp/shirakawa/223707/weather-forecast/223707');
            } catch (e) { document.getElementById('weather-temp').innerText = "--"; }
        }

        function renderTabs() {
            const container = document.getElementById('date-tabs');
            container.innerHTML = Object.keys(myTrip).sort().map(day => `
                <button onclick="switchDay('${day}')" id="btn-${day}" class="date-btn flex-shrink-0 px-6 py-2.5 rounded-full bg-white shadow-sm text-sm font-bold ${currentDay === day ? 'active' : ''}">${day.slice(0,2)}/${day.slice(2)}</button>
            `).join('');
        }

        function switchDay(day) {
            currentDay = day; fetchWeather(myTrip[day].city); renderContent(); renderTabs();
        }

        function renderContent() {
            const container = document.getElementById('app-content');
            const data = myTrip[currentDay];
            container.innerHTML = `<h2 class="text-xl font-bold mb-2">${data.title}</h2>`;
            container.innerHTML += data.spots.map((spot, index) => {
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(spot.name)}`;
                return `
                <div class="spot-card p-5" onclick="${isEditMode ? '' : `window.open('${mapLink}')`}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-base font-bold text-gray-800">${spot.name}</h3>
                            <p class="text-[12px] text-gray-500 mt-1 leading-snug">${spot.desc}</p>
                        </div>
                        <div class="text-right ml-4">
                            <span class="text-sm font-black text-[#8C7355] font-mono">${spot.time}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        renderTabs(); switchDay("1221");
    </script>
</body>
</html>
