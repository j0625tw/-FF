<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>哪夠呀・NAGOYA 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --base: #F5F2ED; --accent: #8C7355; --text: #4A443F; }
        body { background-color: var(--base); color: var(--text); font-family: -apple-system, sans-serif; }
        .weather-card { background: linear-gradient(135deg, #8C7355 0%, #6D5942 100%); color: white; border-radius: 24px; box-shadow: 0 10px 20px rgba(140, 115, 85, 0.2); }
        .spot-card { background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-left: 5px solid var(--accent); position: relative; transition: transform 0.1s; cursor: pointer; }
        .spot-card:active { transform: scale(0.98); }
        .floating-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 450px; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100; }
        .date-btn.active { background: var(--accent); color: white; transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input, textarea { background: #f9f8f6; border: 1px solid #e2e0db; border-radius: 8px; padding: 6px 10px; width: 100%; font-size: 14px; }
    </style>
</head>
<body class="pb-36">

    <header class="pt-8 px-6 mb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-black text-[#8C7355] italic tracking-tighter">NAGOYA</h1>
            <p class="text-[10px] tracking-[0.2em] text-gray-400 font-bold uppercase">Winter Trip 2025</p>
        </div>
        <button onclick="toggleEditMode()" id="edit-toggle" class="bg-stone-200 px-4 py-1 rounded-full text-[10px] font-bold">EDIT: OFF</button>
    </header>

    <div class="px-6 mb-6">
        <div class="weather-card p-6 flex justify-between items-center relative overflow-hidden">
            <div class="z-10">
                <p id="weather-city" class="text-xs font-bold opacity-80 tracking-widest uppercase mb-1">LOADING</p>
                <div class="flex items-center">
                    <span id="weather-temp" class="text-5xl font-light">--</span>
                    <span class="text-2xl ml-1">°C</span>
                </div>
                <p id="weather-desc" class="text-sm mt-1 font-medium italic">點擊看雨勢預報</p>
            </div>
            <div class="text-right z-10">
                <i id="weather-icon" class="fas fa-cloud-showers-heavy text-6xl opacity-30"></i>
            </div>
        </div>
    </div>

    <div class="flex overflow-x-auto px-6 space-x-3 mb-6 no-scrollbar" id="date-tabs"></div>
    <main id="app-content" class="px-6 space-y-4"></main>

    <div id="add-modal" class="fixed inset-0 bg-black/60 z-[200] hidden flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 space-y-4">
            <h3 class="text-xl font-bold">新增行程</h3>
            <input type="text" id="new-time" placeholder="時間 (09:00)">
            <input type="text" id="new-name" placeholder="名稱">
            <textarea id="new-desc" placeholder="詳情"></textarea>
            <div class="flex space-x-3 pt-2">
                <button onclick="saveNewSpot()" class="flex-1 bg-[#8C7355] text-white py-3 rounded-2xl font-bold">儲存</button>
                <button onclick="closeModal()" class="flex-1 bg-stone-100 text-gray-500 py-3 rounded-2xl font-bold">取消</button>
            </div>
        </div>
    </div>

    <nav class="floating-nav px-8 py-4 flex justify-between items-center text-[#8C7355]">
        <div onclick="window.scrollTo({top:0, behavior:'smooth'})" class="flex flex-col items-center">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[9px] font-bold mt-1">HOME</span>
        </div>
        <div onclick="showAddModal()" class="bg-[#8C7355] text-white w-12 h-12 rounded-full flex items-center justify-center -mt-10 shadow-lg border-4 border-[#F5F2ED]">
            <i class="fas fa-plus text-xl"></i>
        </div>
        <div onclick="exportData()" class="flex flex-col items-center text-gray-300">
            <i class="fas fa-sync-alt text-xl"></i>
            <span class="text-[9px] font-bold mt-1">SYNC</span>
        </div>
    </nav>

    <script>
        const defaultData = {
            "1221": { title: "Day 1：抵達名古屋", city: "Nagoya", spots: [
                { time: "14:55", name: "桃園機場", desc: "星宇 JX838 18:30 抵達" },
                { time: "19:00", name: "名鐵 μ-SKY", desc: "中部機場 → 名古屋站" },
                { time: "20:15", name: "名古屋車站地下街", desc: "晚餐：味噌豬排、鰻魚飯、金鯱橫丁" }
            ]},
            "1222": { title: "Day 2：犬山城與榮區購物", city: "Inuyama", spots: [
                { time: "08:30", name: "名古屋站", desc: "搭乘名鐵前往「犬山遊園站」" },
                { time: "09:30", name: "犬山城天守閣", desc: "登頂避人潮，眺望木曾川全景" },
                { time: "11:00", name: "三光稻荷神社", desc: "拍照紅色鳥居" },
                { time: "12:00", name: "犬山城下町", desc: "午餐邊走邊吃，約14:00離開" },
                { time: "15:00", name: "大須觀音(視體力)", desc: "走馬看花逛商店街，順向逛向榮區" },
                { time: "17:00", name: "榮區商圈", desc: "Parco、Lachic、百貨逛街購物" },
                { time: "19:00", name: "Oasis 21", desc: "點燈水之宇宙船與電視塔" }
            ]},
            "1223": { title: "Day 3：名古屋 → 高山", city: "Takayama", spots: [
                { time: "07:45", name: "名古屋巴士總站", desc: "搭乘濃飛巴士前往高山" },
                { time: "11:00", name: "高山陣屋 / 早市", desc: "歷史建築與市集" },
                { time: "13:30", name: "上三之町老街", desc: "飛驒牛小吃、古街散策" },
                { time: "18:00", name: "丸明 飛驒牛", desc: "晚餐燒肉盛宴" }
            ]},
            "1224": { title: "Day 4：雨天撤離！名古屋室內行", city: "Nagoya", spots: [
                { time: "08:00", name: "宮川早市/高山老街", desc: "最後快速巡禮補貨，準備撤離" },
                { time: "10:00", name: "高山濃飛巴士站", desc: "搭乘巴士回名古屋(預計12:45抵達)" },
                { time: "13:00", name: "名古屋站午餐", desc: "車站地下街快速解決" },
                { time: "14:00", name: "豐田產業技術紀念館", desc: "【躲雨首選】展示極美，最後入場16:30" },
                { time: "17:00", name: "則武之森 AEON", desc: "超美蔦屋書店巨型書牆，逛超市補貨" }
            ]},
            "1225": { title: "Day 5：吉卜力全日", city: "Nagakute", spots: [
                { time: "08:30", name: "名古屋站出發", desc: "東山線至藤之丘轉 Linimo" },
                { time: "09:30", name: "E1 接駁站牌", desc: "搭接駁巴士前往動動力森林" },
                { time: "10:00", name: "動動力森林", desc: "核心展區參觀" },
                { time: "14:00", name: "吉卜力大倉庫", desc: "下午主要活動區" }
            ]},
            "1226": { title: "Day 6：最終補貨與歸途", city: "Nagoya", spots: [
                { time: "09:00", name: "熱田神宮", desc: "悠閒參拜" },
                { time: "11:00", name: "大須商店街 / 名古屋城", desc: "最後補貨採買" },
                { time: "15:30", name: "名古屋站", desc: "搭 μ-SKY 前往機場" },
                { time: "19:40", name: "中部機場 (JX839)", desc: "22:15 返抵桃園" }
            ]}
        };

        let myTrip = JSON.parse(localStorage.getItem('nagoya_trip')) || defaultData;
        let currentDay = "1221";
        let isEditMode = false;

        async function fetchWeather(city) {
            const cities = { "Nagoya": { lat: 35.18, lon: 136.90 }, "Takayama": { lat: 36.14, lon: 137.25 }, "Ono": { lat: 36.27, lon: 136.90 }, "Inuyama": { lat: 35.38, lon: 136.94 }, "Nagakute": { lat: 35.18, lon: 137.05 } };
            const { lat, lon } = cities[city] || cities["Nagoya"];
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await res.json();
                document.getElementById('weather-temp').innerText = Math.round(data.current_weather.temperature);
                document.getElementById('weather-city').innerText = city;
                document.getElementById('weather-desc').onclick = () => window.open('https://www.accuweather.com/zh/jp/nagoya-shi/224967/weather-forecast/224967');
            } catch (e) { document.getElementById('weather-temp').innerText = "--"; }
        }

        function renderTabs() {
            const container = document.getElementById('date-tabs');
            container.innerHTML = Object.keys(myTrip).sort().map(day => `
                <button onclick="switchDay('${day}')" id="btn-${day}" class="date-btn flex-shrink-0 px-6 py-2.5 rounded-full bg-white shadow-sm text-sm font-bold ${currentDay === day ? 'active' : ''}">${day.slice(0,2)}/${day.slice(2)}</button>
            `).join('');
        }

        function switchDay(day) {
            currentDay = day; fetchWeather(myTrip[day].city); renderContent(); renderTabs();
        }

        function renderContent() {
            const container = document.getElementById('app-content');
            const data = myTrip[currentDay];
            container.innerHTML = `<h2 class="text-xl font-bold mb-2">${data.title}</h2>`;
            container.innerHTML += data.spots.map((spot, index) => `
                <div class="spot-card p-5" onclick="${isEditMode ? '' : `window.open('http://googleusercontent.com/maps.google.com/maps?q=${encodeURIComponent(spot.name)}')`}">
                    ${isEditMode ? `<button onclick="event.stopPropagation(); deleteSpot(${index})" class="text-red-500 absolute top-4 right-4"><i class="fas fa-times-circle"></i></button>` : ''}
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            ${isEditMode ? `<input type="text" onchange="updateSpot(${index}, 'name', this.value)" value="${spot.name}" class="font-bold mb-1 w-full" onclick="event.stopPropagation()">` : `<h3 class="text-base font-bold text-gray-800">${spot.name}</h3>`}
                            ${isEditMode ? `<textarea onchange="updateSpot(${index}, 'desc', this.value)" class="mt-1 w-full" onclick="event.stopPropagation()">${spot.desc}</textarea>` : `<p class="text-[12px] text-gray-500 mt-1 leading-snug">${spot.desc}</p>`}
                        </div>
                        <div class="text-right ml-4">
                            ${isEditMode ? `<input type="text" onchange="updateSpot(${index}, 'time', this.value)" value="${spot.time}" class="text-sm font-black text-right w-16" onclick="event.stopPropagation()">` : `<span class="text-sm font-black text-[#8C7355] font-mono">${spot.time}</span>`}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            document.getElementById('edit-toggle').innerText = `EDIT: ${isEditMode ? 'ON' : 'OFF'}`;
            document.getElementById('edit-toggle').classList.toggle('bg-[#8C7355]');
            document.getElementById('edit-toggle').classList.toggle('text-white');
            renderContent();
        }

        function updateSpot(index, field, value) { myTrip[currentDay].spots[index][field] = value; saveData(); }
        function deleteSpot(index) { if(confirm('刪除？')) { myTrip[currentDay].spots.splice(index, 1); saveData(); renderContent(); } }
        function showAddModal() { document.getElementById('add-modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('add-modal').classList.add('hidden'); }
        function saveNewSpot() {
            const newSpot = { time: document.getElementById('new-time').value, name: document.getElementById('new-name').value, desc: document.getElementById('new-desc').value };
            myTrip[currentDay].spots.push(newSpot); myTrip[currentDay].spots.sort((a,b) => a.time.localeCompare(b.time)); saveData(); renderContent(); closeModal();
        }
        function saveData() { localStorage.setItem('nagoya_trip', JSON.stringify(myTrip)); }
        function exportData() { prompt("同步代碼:", JSON.stringify(myTrip)); }

        renderTabs(); switchDay("1221");
    </script>
</body>
</html>
